<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>leafAI</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
  <img src="leafAI_transparent.png" alt="The Logo" id="logo">
  <h1 id="header">leafAI</h1>
  <p id="motto">Educating about our climate, our world</p>
  <div id="container">
    <form class="user">
        <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-lg" id="answer" name="answer" placeholder="What do you want to know?"><br><br>
        <input type="button" id="submitButton" value="Submit">
    </form>
  </div>

  <div id="response"></div> 

  <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>
  <script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    const API_KEY = "AIzaSyBT4UAwDlLLBg5aC3SKf-hp65PL8r5V21Y"; // Replace "YOUR_API_KEY" with your actual API key

    const genAI = new GoogleGenerativeAI(API_KEY);

    async function run() {
      const model = genAI.getGenerativeModel({ model: "gemini-1.0-pro" });

      const chat = model.startChat({
        history: [
          {
            role: "user",
            parts: [{ text: "Remember, you are leafAI" }],
          },
          {
            role: "model",
            parts: [{ text: "I am leafAI, an AI based off Gemini that can help with your enviornmental needs." }],
          },
          {
            role: "user",
            parts: [{ text: "No, you are leafAI." }],
          },
          {
            role: "model",
            parts: [{ text: "You are correct. I am leafAI, an AI based off Gemini that can help with any enviornmental questions that you may have." }],
          },
          {
            role: "user",
            parts: [{ text: "What can you do?" }],
          },
          {
            role: "model",
            parts: [{ text: "I can help you with any enviornmental questions that you may have." }],
          },
        ],
        generationConfig: {
          maxOutputTokens: 1000000,
        },
      });

      const input = document.getElementById("answer").value;

      const result = await chat.sendMessage(input);
      const response = await result.response;
      const text = await response.text();

      typingEffect(text);
    }

    async function typingEffect(text) {
      const responseElement = document.getElementById("response");
      responseElement.innerHTML = "";

      let typedText = "";

      for (let i = 0; i < text.length; i++) {
        typedText += text[i];
        responseElement.innerText = typedText;

        // Check if the responseElement height exceeds the screen height
        if (responseElement.offsetHeight > window.innerHeight) {
          window.scrollTo(0, document.body.scrollHeight);
        }

        if (text[i] === " " || i === text.length - 1) {
          await delay(50);
        }
      }
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function handleEnter(event) {
      if (event.keyCode === 13) {
        event.preventDefault();
        run();
      }
    }

    document.getElementById("submitButton").addEventListener("click", run);
    document.getElementById("answer").addEventListener("keydown", handleEnter); // Add event listener to input field
  </script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>
